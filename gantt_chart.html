<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timeline - Gantt Chart</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --connector-width: 2px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .gantt-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin: 0 0 40px 0;
            letter-spacing: -1px;
        }
        
        .gantt-wrapper {
            position: relative;
        }
        
        .gantt-chart {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 0;
            position: relative;
        }
        
        .task-section {
            position: relative;
            overflow: visible; /* Allow connectors to extend past */
        }
        
        /* Clip container for milestone connectors */
        .milestone-clip-wrapper {
            position: relative;
            overflow: hidden;
        }
        
        .gantt-row {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        
        .gantt-row:last-child {
            border-bottom: none;
        }
        
        .col-task {
            width: 320px;
            min-width: 320px;
            padding: 16px 20px;
            background: #f8f9fa;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .task-name {
            font-weight: 600;
            font-size: 15px;
            color: #333;
        }
        
        .subtasks {
            margin-top: 8px;
            padding-left: 4px;
        }
        
        .subtask {
            font-size: 11px;
            font-weight: 400;
            color: #666;
            line-height: 1.4;
            margin-bottom: 4px;
            padding-left: 12px;
            position: relative;
        }
        
        .subtask:last-child {
            margin-bottom: 0;
        }
        
        .subtask::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #999;
        }
        
        .col-timeline {
            flex: 1;
            min-width: 700px;
            position: relative;
        }
        
        /* Header row styling */
        .header-row {
            background: #333;
            color: white;
            border-bottom: 1px solid #555;
            position: relative;
            z-index: 20; /* Ensure header is above connector lines */
        }
        
        .header-row .col-task {
            background: #333;
            border-right-color: #555;
            color: white;
            font-size: 16px;
        }
        
        .header-row .col-timeline {
            display: flex;
            flex-direction: column;
            min-width: 0; /* Allow flex item to shrink below content size */
        }
        
        .month-header {
            display: grid;
            height: 40px;
            border-bottom: 1px solid #555;
        }
        
        .month-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            border-right: 1px solid #555;
        }
        
        .month-label:last-child {
            border-right: none;
        }
        
        .day-header {
            display: grid;
            height: 40px;
        }
        
        .day-column {
            display: flex;
            flex-direction: column;
        }
        
        .day-number {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #fff;
            font-weight: 500;
            height: 16px;
            min-width: 100%; /* Ensure number takes full column width */
        }
        
        .day-tick {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: #fff;
            border-right: 1px solid rgba(255,255,255,0.15);
            height: 24px;
        }
        
        .day-tick.weekend {
            color: #888;
        }
        
        .day-tick.month-boundary {
            border-right: 1px solid #555;
        }
        
        .day-tick:last-child {
            border-right: none;
        }
        
        .day-tick.highlight {
            font-weight: bold;
        }
        
        .task-row .col-timeline {
            display: grid;
            align-items: center;
            background: #fafafa;
            min-height: 60px;
        }
        
        .task-bar {
            height: 50px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2), 0 2px 4px rgba(0,0,0,0.15);
            margin: 0 1px;
            padding: 4px 16px;
            position: relative;
            z-index: 10;
            min-width: 160px; /* Increased to ensure "MMM ##–MMM ##" fits comfortably */
            overflow: visible; /* Prevent content clipping */
        }
        
        .task-bar-date {
            font-size: 12px;
            line-height: 1.2;
            white-space: nowrap; /* Prevent date text from wrapping */
            overflow: visible; /* Allow text to be visible */
        }
        
        .task-bar-hours {
            font-size: 10px;
            font-weight: 500;
            line-height: 1.2;
            margin-top: 2px;
            opacity: 0.95;
        }
        
        /* Remove task bar connector - using milestone connector instead */
        
        .grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: grid;
            pointer-events: none;
            z-index: 1;
        }
        
        .grid-line {
            border-right: 1px dashed rgba(0,0,0,0.08);
        }
        
        .grid-line.week-boundary {
            border-right: 1px dashed rgba(0,0,0,0.2);
        }
        
        .grid-line.month-boundary {
            border-right: 1px solid #ddd;
        }
        
        .grid-line:last-child {
            border-right: none;
        }
        
        /* Milestones */
        #milestone-section {
            position: relative;
            overflow: visible;
        }
        
        .milestone-row {
            display: flex;
            margin-top: 20px;
        }
        
        .milestone-spacer {
            width: 320px;
            min-width: 320px;
        }
        
        .milestone-timeline {
            flex: 1;
            min-width: 700px;
            display: grid;
            height: 70px;
            position: relative;
        }
        
        .milestone {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-end;
            justify-self: start;
            position: relative;
            --milestone-color: #0056b3;
        }
        
        .milestone-label {
            background: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #495057;
            border: 2px solid var(--milestone-color, #0056b3);
            text-align: center;
            line-height: 1.3;
            white-space: nowrap;
            position: relative;
            transform: translateX(var(--connector-offset, 0px));
            --connector-height: 0px;
        }
        
        /* Connector from top of milestone label up to task section */
        .milestone-label::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            border-left: var(--connector-width, 2px) dotted var(--milestone-color, #0056b3);
            height: var(--connector-height, 0px);
            z-index: 1;
        }
    </style>
</head>
<body>
    <div class="gantt-container">
        <h1 id="chart-title">PROJECT TIMELINE</h1>
        <div class="gantt-wrapper">
            <div id="gantt-chart" class="gantt-chart"></div>
            <div id="milestone-section"></div>
        </div>
    </div>

    <script>
    // ============================================================
    // CONFIGURATION - Edit this section to customize your chart
    // ============================================================
    
    const CONFIG = {
        // Chart title
        title: "PROJECT TIMELINE",
        
        // Timeline range (inclusive)
        timelineStart: "2025-12-01",
        timelineEnd: "2026-02-07",
        
        // Task definitions
        tasks: [
            {
                name: "Planning & Preparation",
                start: "2025-12-02",
                end: "2025-12-12",
                color: "#dc3545",  // Red
                hours: 20,
                subtasks: [
                    "Define scope: URLs/Domains to audit; discovery and interviews",
                    "Determine test personas/scenarios",
                    "Baseline environment setup, any special access required"
                ]
            },
            {
                name: "Initial Site Scans – Tracking System",
                start: "2025-12-13",
                end: "2025-12-19",
                color: "#17a2b8",  // Teal
                hours: 20
            },
            {
                name: "(Pause for holidays)",
                start: "2025-12-20",
                end: "2026-01-11",
                color: "#9e9e9e",  // Gray
                hours: 0
            },
            {
                name: "Consent Mechanism Testing",
                start: "2026-01-12",
                end: "2026-01-18",
                color: "#28a745",  // Green
                hours: 20
            },
            {
                name: "Analysis and Documentation",
                start: "2026-01-19",
                end: "2026-01-25",
                color: "#6f42c1",  // Purple
                hours: 20
            },
            {
                name: "Final Report and Recommendations",
                start: "2026-01-26",
                end: "2026-02-01",
                color: "#fd7e14",  // Orange
                hours: 20
            }
        ],
        
        // Milestone definitions
        milestones: [
            { name: "Project\nKickoff", date: "2025-12-02", taskIndex: 0 }, // Associated with first task (Planning & Preparation)
            { name: "Testing\nComplete", date: "2026-01-18", taskIndex: 3 }, // Associated with Consent Mechanism Testing
            { name: "Final\nDelivery", date: "2026-02-01", taskIndex: 5 }  // Associated with Final Report
        ],
        
        // Display options
        showMilestones: true,
        highlightEvery: 5,  // Highlight every Nth day tick (set to 0 to disable)
        dateFormat: "short" // "short" = "Dec 3–12", "numeric" = "12/3–12/12"
    };
    
    let CURRENT_TOTAL_DAYS = 0;

    // ============================================================
    // CHART RENDERING ENGINE - No need to edit below this line
    // ============================================================

    // Utility functions
    function parseDate(str) {
        const [y, m, d] = str.split('-').map(Number);
        return new Date(y, m - 1, d);
    }

    function formatDateRange(start, end, format) {
        const s = parseDate(start);
        const e = parseDate(end);
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        if (format === 'numeric') {
            return `${s.getMonth()+1}/${s.getDate()}–${e.getMonth()+1}/${e.getDate()}`;
        }
        
        // Short format
        const sMonth = months[s.getMonth()];
        const eMonth = months[e.getMonth()];
        
        if (s.getMonth() === e.getMonth()) {
            return `${sMonth} ${s.getDate()}–${e.getDate()}`;
        }
        return `${sMonth} ${s.getDate()}–${eMonth} ${e.getDate()}`;
    }

    function getDayOfWeek(date) {
        const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        return days[date.getDay()];
    }

    function daysBetween(start, end) {
        const s = parseDate(start);
        const e = parseDate(end);
        return Math.round((e - s) / (1000 * 60 * 60 * 24)) + 1;
    }

    function getDayIndex(date, timelineStart) {
        const d = parseDate(date);
        const s = parseDate(timelineStart);
        // Calculate days difference more precisely
        const diffTime = d.getTime() - s.getTime();
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return diffDays + 1; // +1 because grid columns are 1-indexed
    }

    // Build timeline data
    function buildTimelineData() {
        const start = parseDate(CONFIG.timelineStart);
        const end = parseDate(CONFIG.timelineEnd);
        const totalDays = Math.round((end - start) / (1000 * 60 * 60 * 24)) + 1;
        
        const months = [];
        const days = [];
        
        let currentDate = new Date(start);
        let currentMonth = null;
        let monthDays = 0;
        
        for (let i = 0; i < totalDays; i++) {
            const monthKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}`;
            
            if (monthKey !== currentMonth) {
                if (currentMonth !== null) {
                    months[months.length - 1].days = monthDays;
                }
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                months.push({
                    name: `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`,
                    days: 0
                });
                currentMonth = monthKey;
                monthDays = 0;
            }
            
            const dayOfWeek = currentDate.getDay(); // 0 = Sunday, 6 = Saturday
            const isWeekStart = dayOfWeek === 1; // Monday is week start
            
            days.push({
                date: new Date(currentDate),
                dayOfWeek: getDayOfWeek(currentDate),
                isMonthEnd: false,
                isWeekStart: isWeekStart
            });
            
            monthDays++;
            currentDate.setDate(currentDate.getDate() + 1);
        }
        
        // Set last month's days
        if (months.length > 0) {
            months[months.length - 1].days = monthDays;
        }
        
        // Mark month boundaries
        let dayIndex = 0;
        for (let m = 0; m < months.length - 1; m++) {
            dayIndex += months[m].days;
            if (dayIndex > 0 && dayIndex <= days.length) {
                days[dayIndex - 1].isMonthEnd = true;
            }
        }
        
        return { months, days, totalDays };
    }

    // Render the chart
    function renderChart() {
        const { months, days, totalDays } = buildTimelineData();
        CURRENT_TOTAL_DAYS = totalDays;
        
        // Set title
        document.getElementById('chart-title').textContent = CONFIG.title;
        
        // Build month header grid template
        const monthGridTemplate = months.map(m => `${m.days}fr`).join(' ');
        const dayGridTemplate = `repeat(${totalDays}, 1fr)`;
        
        // Create header row
        let headerHTML = `
            <div class="gantt-row header-row">
                <div class="col-task">Tasks</div>
                <div class="col-timeline">
                    <div class="month-header" style="grid-template-columns: ${monthGridTemplate}">
                        ${months.map(m => `<div class="month-label">${m.name}</div>`).join('')}
                    </div>
                    <div class="day-header" style="grid-template-columns: ${dayGridTemplate}">
                        ${days.map((d, i) => {
                            const isMonday = d.date.getDay() === 1;
                            const dayNum = isMonday ? d.date.getDate() : '';
                            const highlight = CONFIG.highlightEvery > 0 && (i + 1) % CONFIG.highlightEvery === 0;
                            const isWeekend = d.date.getDay() === 0 || d.date.getDay() === 6;
                            const tickClasses = ['day-tick'];
                            if (highlight) tickClasses.push('highlight');
                            if (isWeekend) tickClasses.push('weekend');
                            if (d.isMonthEnd) tickClasses.push('month-boundary');
                            return `
                                <div class="day-column">
                                    <div class="day-number">${dayNum}</div>
                                    <div class="${tickClasses.join(' ')}">${d.dayOfWeek}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>
        `;
        
        // Create task rows
        let tasksHTML = CONFIG.tasks.map((task, taskIndex) => {
            const startCol = getDayIndex(task.start, CONFIG.timelineStart);
            const endCol = getDayIndex(task.end, CONFIG.timelineStart) + 1;
            const label = formatDateRange(task.start, task.end, CONFIG.dateFormat);
            const hours = task.hours !== undefined ? task.hours : 0;
            const hoursText = hours > 0 ? `${hours} hrs` : '';
            
            // Create grid lines
            const gridLines = days.map((d, i) => {
                const classes = ['grid-line'];
                if (d.isWeekStart) classes.push('week-boundary');
                if (d.isMonthEnd) classes.push('month-boundary');
                return `<div class="${classes.join(' ')}"></div>`;
            }).join('');
            
            // Create subtasks HTML if present
            const subtasksHTML = task.subtasks && task.subtasks.length > 0 
                ? `<div class="subtasks">${task.subtasks.map(st => `<div class="subtask">${st}</div>`).join('')}</div>`
                : '';
            
            return `
                <div class="gantt-row task-row" data-task-index="${taskIndex}">
                    <div class="col-task">
                        <div class="task-name">${task.name}</div>
                        ${subtasksHTML}
                    </div>
                    <div class="col-timeline" style="grid-template-columns: ${dayGridTemplate}">
                        <div class="grid-lines" style="grid-template-columns: ${dayGridTemplate}">
                            ${gridLines}
                        </div>
                        <div class="task-bar" data-task-index="${taskIndex}" style="grid-column: ${startCol} / ${endCol}; background: ${task.color}; --task-line-color: ${task.color};">
                            <div class="task-bar-date">${label}</div>
                            ${hoursText ? `<div class="task-bar-hours">${hoursText}</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        document.getElementById('gantt-chart').innerHTML = headerHTML + `<div class="task-section">${tasksHTML}</div>`;
        
        // Create milestones
        if (CONFIG.showMilestones && CONFIG.milestones.length > 0) {
            const milestonesHTML = `
                <div class="milestone-row">
                    <div class="milestone-spacer"></div>
                    <div class="milestone-timeline" style="grid-template-columns: ${dayGridTemplate}">
                        ${CONFIG.milestones.map((m, index) => {
                            const col = getDayIndex(m.date, CONFIG.timelineStart);
                            const label = m.name.replace(/\n/g, '<br>');
                            const associatedTask = CONFIG.tasks[m.taskIndex];
                            const connectorColor = associatedTask ? associatedTask.color : '#0056b3';
                            return `
                                <div class="milestone" data-milestone-index="${index}" data-task-index="${m.taskIndex}" style="grid-column: ${col}; --milestone-color: ${connectorColor};">
                                    <div class="milestone-label">${label}</div>
                                </div>
                            `;
                        }).join('')}
        </div>
    </div>
            `;
            document.getElementById('milestone-section').innerHTML = milestonesHTML;
            requestAnimationFrame(updateMilestoneConnectors);
        }
    }
    
    function updateMilestoneConnectors() {
        const milestoneTimeline = document.querySelector('.milestone-timeline');
        if (!milestoneTimeline || CURRENT_TOTAL_DAYS === 0) return;
        const timelineRect = milestoneTimeline.getBoundingClientRect();
        const cellWidth = timelineRect.width / CURRENT_TOTAL_DAYS;

        const milestoneElements = document.querySelectorAll('.milestone');
        milestoneElements.forEach((el, index) => {
            const taskIndex = Number(el.getAttribute('data-task-index'));
            const milestoneLabel = el.querySelector('.milestone-label');
            const taskBar = document.querySelector(`.task-bar[data-task-index="${taskIndex}"]`);
            if (!milestoneLabel || !taskBar) return;

            const milestone = CONFIG.milestones[index];
            const col = getDayIndex(milestone.date, CONFIG.timelineStart);
            const targetX = timelineRect.left + ((col - 1) * cellWidth);

            const labelRect = milestoneLabel.getBoundingClientRect();
            const labelCenter = labelRect.left + labelRect.width / 2;
            const horizontalOffset = targetX - labelCenter;

            const barRect = taskBar.getBoundingClientRect();
            const connectorHeight = Math.max(0, labelRect.top - barRect.bottom + 4);

            milestoneLabel.style.setProperty('--connector-height', `${connectorHeight}px`);
            milestoneLabel.style.setProperty('--milestone-color', getComputedStyle(taskBar).getPropertyValue('--task-line-color') || taskBar.style.backgroundColor);
            milestoneLabel.style.setProperty('--connector-offset', `${horizontalOffset}px`);
        });
    }
    
    window.addEventListener('resize', () => requestAnimationFrame(updateMilestoneConnectors));

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', renderChart);
    </script>
</body>
</html>
